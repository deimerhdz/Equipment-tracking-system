import{a as ot}from"./chunk-BJJWRXLE.js";import{a as H,b as y,c as z,d as J,e as K,g as Q,h as W,i as X,j as Z,k as tt,l as et,m as rt}from"./chunk-JBJS33BQ.js";import{a as it}from"./chunk-PQIZKA6A.js";import{a as at}from"./chunk-JWLIMLOG.js";import{$ as u,D as m,H as c,J as x,K as i,L as o,M,N as $,P as f,Q as w,R as n,S as d,U as R,V as D,W as O,X as V,Z as C,_ as j,aa as T,e as pt,ga as P,ia as E,ja as L,k,ka as U,ma as h,n as B,na as G,o as g,pa as Y,q as p,r as S,s as b,v as I,w as q}from"./chunk-LDKAS3T6.js";var _=(()=>{let t=class t{constructor(){this.http=p(T),this.url=G.url}getAllReports(){return this.http.get(`${this.url}/reports`)}getReportById(e){return this.http.get(`${this.url}/reports/${e}`)}saveReport(e){return this.http.post(`${this.url}/reports`,e)}updateReport(e){return this.http.put(`${this.url}/reports/${e._id}`,e)}deleteReportById(e){return this.http.delete(`${this.url}/reports/${e}`)}};t.\u0275fac=function(s){return new(s||t)},t.\u0275prov=B({token:t,factory:t.\u0275fac,providedIn:"root"});let r=t;return r})();var A=pt(at());function lt(r,t){if(r&1){let l=$();i(0,"tr")(1,"td"),n(2),o(),i(3,"td"),n(4),o(),i(5,"td"),n(6),o(),i(7,"td"),n(8),o(),i(9,"td"),n(10),O(11,"date"),o(),i(12,"td")(13,"button",5),f("click",function(){let a=I(l).$implicit,v=w();return q(v.editReport(a._id))}),n(14,"Editar"),o(),n(15,"\xA0 "),i(16,"button",6),f("click",function(){let a=I(l).$implicit,v=w();return q(v.deleteReport(a._id))}),n(17,"Eliminar"),o()()()}if(r&2){let l=t.$implicit;m(2),d(l._id),m(2),d(l.description),m(2),d(l.equipmentId.name),m(2),d(l.userId.name),m(2),d(V(11,5,l.creationDate))}}var ct=()=>["/dashboard/reports/new-report"],nt=(()=>{let t=class t{constructor(){this.reportService=p(_),this.reports=[],this.router=p(E)}ngOnInit(){this.listReports()}listReports(){this.reportService.getAllReports().subscribe(e=>{this.reports=e.reports})}editReport(e){this.router.navigateByUrl("/dashboard/reports/edit-report/"+e)}deleteReport(e){A.default.fire({title:"Are you sure?",text:"You won't be able to revert this!",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Yes, delete it!"}).then(s=>{s.isConfirmed&&this.reportService.deleteReportById(e).subscribe(a=>{console.log(a),A.default.fire({title:"Deleted!",text:"Your file has been deleted.",icon:"success"}),this.listReports()})})}};t.\u0275fac=function(s){return new(s||t)},t.\u0275cmp=S({type:t,selectors:[["app-report-page"]],standalone:!0,features:[R],decls:22,vars:3,consts:[[1,"col-md-12"],["routerLinkActive","active",1,"btn","btn-primary",3,"routerLink"],[1,"table"],["scope","col"],[4,"ngFor","ngForOf"],[1,"btn","btn-warning",3,"click"],[1,"btn","btn-danger",3,"click"]],template:function(s,a){s&1&&(i(0,"div",0)(1,"h3"),n(2," Report list "),o(),i(3,"a",1),n(4,"Agregar reporte"),o(),i(5,"table",2)(6,"thead")(7,"tr")(8,"th",3),n(9,"#id"),o(),i(10,"th",3),n(11,"Description"),o(),i(12,"th",3),n(13,"Equipment"),o(),i(14,"th",3),n(15,"user"),o(),i(16,"th",3),n(17,"Created at"),o(),i(18,"th",3),n(19,"Acciones"),o()()(),i(20,"tbody"),x(21,lt,18,7,"tr",4),o()()()),s&2&&(m(3),c("routerLink",D(2,ct)),m(18),c("ngForOf",a.reports))},dependencies:[h,L,U,u,C,j]});let r=t;return r})();function dt(r,t){if(r&1&&(i(0,"option",7),n(1),o()),r&2){let l=t.$implicit;c("value",l._id),m(1),d(l.name)}}var N=(()=>{let t=class t{constructor(){this.equipments=[],this.equipmentService=p(ot),this.fb=p(et),this.authService=p(Y),this.reportService=p(_),this.router=p(E),this.activateRoute=p(P),this.socketService=p(it),this.reportForm=this.fb.group({_id:[""],description:["",y.required],equipmentId:["",y.required],userId:["",y.required]})}ngOnInit(){this.getEquipments(),this.reportForm.controls.userId.setValue(this.authService.currentUser().uid),this.router.url.includes("edit-report")&&this.activateRoute.params.pipe(k(({id:e})=>this.reportService.getReportById(e))).subscribe(e=>{if(!e)return this.router.navigateByUrl("/dashboard/reports");this.reportForm.reset(e)})}getEquipments(){this.equipmentService.getAllEquipments().subscribe(e=>{this.equipments=e.equipments})}get currentReport(){return this.reportForm.value}save(){if(this.currentReport._id){this.reportService.updateReport(this.currentReport).subscribe(e=>{this.router.navigateByUrl("/dashboard/reports")});return}this.reportService.saveReport(this.currentReport).subscribe(e=>{this.socketService.sendNotification$("Se ha creado un nuevo reporte con id "+e.report._id),this.router.navigateByUrl("/dashboard/reports")})}};t.\u0275fac=function(s){return new(s||t)},t.\u0275cmp=S({type:t,selectors:[["app-add-report-page"]],standalone:!0,features:[R],decls:15,vars:3,consts:[[1,"col-md-6",3,"formGroup","submit"],[1,"mb-3"],["for",""],["formControlName","description","type","text",1,"form-control"],["formControlName","equipmentId","id","",1,"form-select"],[3,"value",4,"ngFor","ngForOf"],[1,"btn","btn-success",3,"disabled"],[3,"value"]],template:function(s,a){s&1&&(i(0,"form",0),f("submit",function(){return a.save()}),i(1,"h3"),n(2,"New report"),o(),i(3,"div",1)(4,"label",2),n(5,"Description"),o(),M(6,"input",3),o(),i(7,"div",1)(8,"label",2),n(9,"Equipment"),o(),i(10,"select",4),x(11,dt,2,2,"option",5),o()(),i(12,"div",1)(13,"button",6),n(14,"Agregar"),o()()()),s&2&&(c("formGroup",a.reportForm),m(11),c("ngForOf",a.equipments),m(2),c("disabled",a.reportForm.invalid))},dependencies:[u,C,rt,K,Z,tt,H,X,z,J,Q,W]});let r=t;return r})();var ut=[{path:"",component:nt},{path:"new-report",component:N},{path:"edit-report/:id",component:N},{path:"**",redirectTo:""}],st=(()=>{let t=class t{};t.\u0275fac=function(s){return new(s||t)},t.\u0275mod=b({type:t}),t.\u0275inj=g({imports:[h.forChild(ut),h]});let r=t;return r})();var Gt=(()=>{let t=class t{};t.\u0275fac=function(s){return new(s||t)},t.\u0275mod=b({type:t}),t.\u0275inj=g({imports:[u,st]});let r=t;return r})();export{Gt as ReportModule};
